<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=1442, maximum-scale=1.0" />
  <meta name="og:type" content="website" />
  <meta name="twitter:card" content="photo" />
  <link rel="stylesheet" type="text/css" th:href="@{/css/user/sign-in.css}" />
  <link rel="stylesheet" type="text/css" th:href="@{/css/styleguide.css}" />
  <link rel="stylesheet" type="text/css" th:href="@{/css/globals.css}" />
</head>

<body style="margin: 0; background: #ffffff">
  <input type="hidden" id="anPageName" name="page" value="sign-in" />
  <div class="container-center-horizontal">
    <div class="sign-in screen">
      <div class="x1">
        <h1 class="text-1">로그인</h1>

        <div class="overlap-group1">
          <form onsubmit="submitForm(event)">
            <div class="button-primary-with-icon">
              <div class="frame-1">
                <input type="email" id="email" name="email" class="button-name valign-text-middle regular16px"
                  style="border:none; width: 390px;" placeholder="이메일을 입력해 주세요">
              </div>
            </div>
            <div class="button-primary-with-icon-1 button-primary-with-icon-3">
              <div class="frame-1">
                <input type="password" id="password" name="password" class="button-name valign-text-middle regular16px"
                  style="border:none; width: 390px;" placeholder="비밀번호를 입력해 주세요">
              </div>
            </div>
            <div class="text regular13px">
              <div class="check">
                <div class="shape"></div>
                <div class="text-3">이메일 저장</div>
              </div>
              <div class="text-4">이메일 찾기</div>
              <div class="text-2">비밀번호 찾기</div>
            </div>
            <button type="submit" class="light-button" style="cursor: pointer;">
              <div class="text-6 valign-text-middle presetsbody2">로그인</div>
            </button>
          </form>

          <div class="overlap-group">
            <div class="button-primary-with-icon-2 button-primary-with-icon-3">
              <div class="frame-1">
                <div class="button-name-1 valign-text-middle bold16px">Google 계정으로 로그인</div>
              </div>
            </div>
            <img class="google-2" src="/img/google-2-1@2x.png" alt="google 2" />
          </div>

          <div class="text-5 valign-text-middle regular13px">
            <span>
              <span class="span0 regular13px">계정이 없으신가요? </span>
              <a th:href="@{/user/join}">
                <span class="span1 bold13px">회원가입</span>
              </a>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>

  <script>
    // 로그인
    function submitForm(event) {
      event.preventDefault();

      var email = document.getElementById('email').value;
      var passwordField = document.getElementById('password');
  var password = passwordField.value;

      if (!email) {
        alert("이메일을 입력하세요.");
        return;
      }
      if (!password) {
        alert("비밀번호를 입력하세요.");
        return;
      }

      var data = {
        "email": email,
        "password": password
      };

      fetch('/user/login', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      })
        .then(response => {
          if (!response.ok) {
            // 존재하지 않는 사용자
            if (response.status === 404) {
              return response.json().then(json => {
                const errorMessage = json.message;
                alert(errorMessage)

                throw new Error(errorMessage);
              });
            }
            // 비밀번호 오류
            if (response.status === 400) {
              return response.json().then(json => {
                const errorMessage = json.message;
                alert(errorMessage)
                // 비밀번호 필드 값 비우기
                passwordField.value = '';

                throw new Error(errorMessage);
              });
            }
            throw new Error('서버에서 오류 응답을 받았습니다.');
          }
          alert("로그인에 성공했습니다.");
          window.location.href = '/';
        })
        .catch(error => {
          console.error(error);
        });
    }

  </script>
</body>

</html>